#!/usr/bin/env ruby

$LOAD_PATH.unshift(File.join(__dir__, '../lib'))

#
# move old classes aside, start on:
#
# args
# base (superclass)
# main
# middleware/log_formatter (use rate limiting gem)
# nokogiri_ext
# csv (used to be called output)
# response
#

BIN = File.basename($PROGRAM_NAME)

#
# Load the bare minimum and parse args with slop. We do this separately for speed.
#

require 'sinews/args'
begin
  slop = Sinews::Args.slop(ARGV)
rescue Slop::Error => e
  $stderr.puts "#{BIN}: #{e}" if e.message != ''
  $stderr.puts("#{BIN}: try '#{BIN} --help' for more information")
  exit 1
end

#
# now load everything and run
#

require 'sinew'
Sinews::Main.new(slop).run
